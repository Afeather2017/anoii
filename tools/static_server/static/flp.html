<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”çº¿è°±è¯†è°±ç»ƒä¹ </title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .staff-container {
            position: relative;
            height: 200px;
            margin: 30px 0;
            border: 1px solid #ddd;
            background-color: #fff;
            overflow: hidden;
        }
        
        .staff-line {
            position: absolute;
            width: 100%;
            height: 1px;
            background-color: #000;
        }
        
        .note {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: black;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .option {
            padding: 15px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
            color: black;
        }
        
        .option:hover {
            background-color: #e0e0e0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .stats {
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
        }
        
        .correct {
            background-color: #4CAF50 !important;
            color: white;
        }
        
        .incorrect {
            background-color: #f44336 !important;
            color: white;
        }
        
        .ledger-line {
            position: absolute;
            width: 30px;
            height: 1px;
            background-color: #000;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .clef {
            position: absolute;
            font-size: 90px;
            left: 20%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .bass-clef {
            font-size: 90px;
            top: 55%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>äº”çº¿è°±è¯†è°±ç»ƒä¹ </h1>
        
        <div class="staff-container" id="staff">
            <!-- äº”çº¿è°±çº¿å’ŒéŸ³ç¬¦å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="options-container" id="options">
            <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="controls">
            <button id="nextBtn">ä¸‹ä¸€é¢˜</button>
            <button id="resetBtn">é‡ç½®ç»Ÿè®¡</button>
        </div>
        
        <div class="stats" id="stats">
            <p>å·²ç­”é¢˜: <span id="total">0</span> | æ­£ç¡®: <span id="correct">0</span> | é”™è¯¯: <span id="wrong">0</span> | æ­£ç¡®ç‡: <span id="accuracy">0%</span></p>
        </div>
    </div>

    <script>
        // äº”çº¿è°±åŸºç¡€çŸ¥è¯†
        // é«˜éŸ³è°±å·ï¼ˆGè°±å·ï¼‰å®šä¹‰ç¬¬äºŒçº¿ä¸ºGéŸ³ï¼ˆsolï¼‰[4](@ref)
        // ä½éŸ³è°±å·ï¼ˆFè°±å·ï¼‰å®šä¹‰ç¬¬å››çº¿ä¸ºFéŸ³ï¼ˆfaï¼‰[4](@ref)
        // éŸ³åCDEFGABå¯¹åº”ç®€è°±1234567[6,7](@ref)
        
        // é«˜éŸ³è°±è¡¨éŸ³ç¬¦ä½ç½®ä¸éŸ³åæ˜ å°„ï¼ˆä»ä¸‹åŠ ä¸‰çº¿åˆ°ä¸ŠåŠ ä¸‰çº¿ï¼‰
        const trebleNotes = [
            { line: -3,   name: "F3", number: "4" }, // ä¸‹åŠ ä¸‰çº¿
            { line: -2.5, name: "G3", number: "5" }, // ä¸‹åŠ ä¸‰é—´
            { line: -2,   name: "A3", number: "6" }, // ä¸‹åŠ äºŒçº¿
            { line: -1.5, name: "B3", number: "7" }, // ä¸‹åŠ äºŒé—´
            { line: -1,   name: "C4", number: "1" }, // ä¸‹åŠ ä¸€çº¿
            { line: -0.5, name: "D4", number: "2" }, // ä¸‹åŠ ä¸€é—´
            { line: 0,    name: "E4", number: "3" }, // ç¬¬ä¸€çº¿
            { line: 0.5,  name: "F4", number: "4" }, // ç¬¬ä¸€é—´
            { line: 1,    name: "G4", number: "5" }, // ç¬¬äºŒçº¿
            { line: 1.5,  name: "A4", number: "6" }, // ç¬¬äºŒé—´
            { line: 2,    name: "B4", number: "7" }, // ç¬¬ä¸‰çº¿
            { line: 2.5,  name: "C5", number: "1" }, // ç¬¬ä¸‰é—´
            { line: 3,    name: "D5", number: "2" }, // ç¬¬å››çº¿
            { line: 3.5,  name: "E5", number: "3" }, // ç¬¬å››é—´
            { line: 4,    name: "F5", number: "4" }, // ç¬¬äº”çº¿
            { line: 4.5,  name: "G5", number: "5" }, // ä¸ŠåŠ ä¸€é—´
            { line: 5,    name: "A5", number: "6" }, // ä¸ŠåŠ ä¸€çº¿
            { line: 5.5,  name: "B5", number: "7" }, // ä¸ŠåŠ äºŒé—´
            { line: 6,    name: "C6", number: "1" }, // ä¸ŠåŠ äºŒçº¿
            { line: 6.5,  name: "D6", number: "2" }, // ä¸ŠåŠ ä¸‰é—´
            { line: 7,    name: "E6", number: "3" }  // ä¸ŠåŠ ä¸‰çº¿
        ];
        
        // ä½éŸ³è°±è¡¨éŸ³ç¬¦ä½ç½®ä¸éŸ³åæ˜ å°„ï¼ˆä»ä¸‹åŠ ä¸‰çº¿åˆ°ä¸ŠåŠ ä¸‰çº¿ï¼‰
        const bassNotes = [
            { line: -3,   name: "A1", number: "6" }, // ä¸‹åŠ ä¸‰çº¿
            { line: -2.5, name: "B1", number: "7" }, // ä¸‹åŠ ä¸‰é—´
            { line: -2,   name: "C2", number: "1" }, // ä¸‹åŠ äºŒçº¿
            { line: -1.5, name: "D2", number: "2" }, // ä¸‹åŠ äºŒé—´
            { line: -1,   name: "E2", number: "3" }, // ä¸‹åŠ ä¸€çº¿
            { line: -0.5, name: "F2", number: "4" }, // ä¸‹åŠ ä¸€é—´
            { line: 0,    name: "G2", number: "5" }, // ç¬¬ä¸€çº¿
            { line: 0.5,  name: "A2", number: "6" }, // ç¬¬ä¸€é—´
            { line: 1,    name: "B2", number: "7" }, // ç¬¬äºŒçº¿
            { line: 1.5,  name: "C3", number: "1" }, // ç¬¬äºŒé—´
            { line: 2,    name: "D3", number: "2" }, // ç¬¬ä¸‰çº¿
            { line: 2.5,  name: "E3", number: "3" }, // ç¬¬ä¸‰é—´
            { line: 3,    name: "F3", number: "4" }, // ç¬¬å››çº¿
            { line: 3.5,  name: "G3", number: "5" }, // ç¬¬å››é—´
            { line: 4,    name: "A3", number: "6" }, // ç¬¬äº”çº¿
            { line: 4.5,  name: "B3", number: "7" }, // ä¸ŠåŠ ä¸€é—´
            { line: 5,    name: "C4", number: "1" }, // ä¸ŠåŠ ä¸€çº¿
            { line: 5.5,  name: "D4", number: "2" }, // ä¸ŠåŠ äºŒé—´
            { line: 6,    name: "E4", number: "3" }, // ä¸ŠåŠ äºŒçº¿
            { line: 6.5,  name: "F4", number: "4" }, // ä¸ŠåŠ ä¸‰é—´
            { line: 7,    name: "G4", number: "5" }  // ä¸ŠåŠ ä¸‰çº¿
        ];

        // å…¨å±€å˜é‡
        let currentNote = null;
        let currentClef = "treble"; // é»˜è®¤é«˜éŸ³è°±å·
        let totalQuestions = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        
        // DOMå…ƒç´ 
        const staffElement = document.getElementById("staff");
        const optionsElement = document.getElementById("options");
        const nextButton = document.getElementById("nextBtn");
        const resetButton = document.getElementById("resetBtn");
        const totalElement = document.getElementById("total");
        const correctElement = document.getElementById("correct");
        const wrongElement = document.getElementById("wrong");
        const accuracyElement = document.getElementById("accuracy");
        
        // åˆå§‹åŒ–
        document.addEventListener("DOMContentLoaded", function() {
            generateQuestion();
            nextButton.addEventListener("click", generateQuestion);
            resetButton.addEventListener("click", resetStats);
        });
        
        // ç”Ÿæˆé—®é¢˜
        function generateQuestion() {
            // æ¸…ç©ºäº”çº¿è°±å’Œé€‰é¡¹
            staffElement.innerHTML = "";
            optionsElement.innerHTML = "";
            
            // éšæœºé€‰æ‹©è°±å·ï¼ˆé«˜éŸ³æˆ–ä½éŸ³ï¼‰
            currentClef = Math.random() > 0.5 ? "treble" : "bass";
            
            // è·å–å¯¹åº”è°±å·çš„éŸ³ç¬¦åˆ—è¡¨
            const notes = currentClef === "treble" ? trebleNotes : bassNotes;
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªéŸ³ç¬¦ï¼ˆæ’é™¤è¿‡äºç®€å•æˆ–å›°éš¾çš„éŸ³ç¬¦ï¼‰
            const noteIndex = Math.floor(Math.random() * (notes.length - 6)) + 3;
            currentNote = notes[noteIndex];
            
            // ç»˜åˆ¶äº”çº¿è°±
            drawStaff();
            
            console.log("node: line=" + currentNote.line +
                        " name=" + currentNote.name + 
                        " number=" + currentNote.number);
            // ç»˜åˆ¶éŸ³ç¬¦
            drawNote(currentNote.line);
            
            // ç”Ÿæˆé€‰é¡¹
            generateOptions(notes, noteIndex);
        }
        
        // ç»˜åˆ¶äº”çº¿è°±
        function drawStaff() {
            // ç»˜åˆ¶äº”æ¡çº¿
            for (let i = 0; i < 5; i++) {
                const line = document.createElement("div");
                line.className = "staff-line";
                line.style.top = `${50 + i * 20}px`;
                staffElement.appendChild(line);
            }
            
            // ç»˜åˆ¶è°±å·
            const clef = document.createElement("div");
            clef.className = currentClef === "treble" ? "clef" : "clef bass-clef";
            clef.textContent = currentClef === "treble" ? "ğ„" : "ğ„¢";
            staffElement.appendChild(clef);
        }
        
        // ç»˜åˆ¶éŸ³ç¬¦
        function drawNote(linePosition) {
            // è®¡ç®—éŸ³ç¬¦çš„å‚ç›´ä½ç½®ï¼ˆäº”çº¿è°±ç¬¬ä¸€çº¿çš„lineä¸º0ï¼‰
            const staffCenter = 120;
            const noteTop = staffCenter - linePosition * 2 * 10;
            console.log("draw at: " + noteTop);
            
            // åˆ›å»ºéŸ³ç¬¦å…ƒç´ 
            const note = document.createElement("div");
            note.className = "note";
            note.style.top = `${noteTop}px`;
            staffElement.appendChild(note);
            
            // å¦‚æœéœ€è¦ï¼Œç»˜åˆ¶åŠ çº¿
            if (linePosition < 0 || linePosition > 4) {
                drawLedgerLines(linePosition, noteTop);
            }
        }
        
        // ç»˜åˆ¶åŠ çº¿
        function drawLedgerLines(linePosition, noteTop) {
            // è®¡ç®—éœ€è¦ç»˜åˆ¶çš„åŠ çº¿æ•°é‡
            let linesToDraw = [];
            
            if (linePosition < 0) {
                // ä¸‹åŠ çº¿
                for (let i = -1; i >= linePosition; i--) {
                    linesToDraw.push(i);
                }
            } else if (linePosition > 4) {
                // ä¸ŠåŠ çº¿
                for (let i = 5; i <= linePosition; i++) {
                    linesToDraw.push(i);
                }
            }
            
            // ç»˜åˆ¶åŠ çº¿
            linesToDraw.forEach(line => {
                const ledgerLine = document.createElement("div");
                ledgerLine.className = "ledger-line";
                const lineTop = 130 - line * 2 * 10;
                ledgerLine.style.top = `${lineTop}px`;
                console.log("draw ledgerline=" + line + " at " + lineTop);
                staffElement.appendChild(ledgerLine);
            });
        }
        
        // ç”Ÿæˆé€‰é¡¹
        function generateOptions(notes, correctIndex) {
            const correctNote = notes[correctIndex];
            
            // åˆ›å»ºé€‰é¡¹æ•°ç»„ï¼ˆåŒ…å«æ­£ç¡®ç­”æ¡ˆï¼‰
            let options = [
                { value: "name", text: correctNote.name, isCorrect: true },
                { value: "number", text: correctNote.number, isCorrect: true }
            ];
            
            // ç”Ÿæˆé”™è¯¯é€‰é¡¹ï¼ˆéšæœºé€‰æ‹©å…¶ä»–éŸ³ç¬¦ï¼‰
            const allNotes = currentClef === "treble" ? trebleNotes : bassNotes;
            const wrongOptions = [];
            
            while (wrongOptions.length < 6) {
                const randomIndex = Math.floor(Math.random() * allNotes.length);
                if (randomIndex !== correctIndex) {
                    const wrongNote = allNotes[randomIndex];
                    
                    // éšæœºé€‰æ‹©æ˜¾ç¤ºéŸ³åæˆ–ç®€è°±
                    const optionType = Math.random() > 0.5 ? "name" : "number";
                    const optionText = optionType === "name" ? wrongNote.name : wrongNote.number;
                    
                    // é¿å…é‡å¤é€‰é¡¹
                    if (!wrongOptions.some(opt => opt.text === optionText) && 
                        !options.some(opt => opt.text === optionText)) {
                        wrongOptions.push({
                            value: optionType,
                            text: optionText,
                            isCorrect: false
                        });
                    }
                }
            }
            
            // åˆå¹¶é€‰é¡¹å¹¶éšæœºæ’åº
            options = options.concat(wrongOptions.slice(0, 6));
            shuffleArray(options);
            
            // åˆ›å»ºé€‰é¡¹æŒ‰é’®
            options.forEach(option => {
                const button = document.createElement("button");
                button.className = "option";
                button.textContent = option.text;
                button.addEventListener("click", function() {
                    checkAnswer(option.isCorrect, button);
                });
                optionsElement.appendChild(button);
            });
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(isCorrect, button) {
            totalQuestions++;
            
            if (isCorrect) {
                correctAnswers++;
                button.classList.add("correct");
            } else {
                wrongAnswers++;
                button.classList.add("incorrect");
                
                // é«˜äº®æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                const options = optionsElement.querySelectorAll(".option");
                options.forEach(opt => {
                    if (opt.textContent === currentNote.name || opt.textContent === currentNote.number) {
                        opt.classList.add("correct");
                    }
                });
            }
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®
            const options = optionsElement.querySelectorAll(".option");
            options.forEach(opt => {
                opt.disabled = true;
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            totalElement.textContent = totalQuestions;
            correctElement.textContent = correctAnswers;
            wrongElement.textContent = wrongAnswers;
            
            const accuracy = totalQuestions > 0 ? (correctAnswers / totalQuestions * 100).toFixed(1) : 0;
            accuracyElement.textContent = `${accuracy}%`;
        }
        
        // é‡ç½®ç»Ÿè®¡
        function resetStats() {
            totalQuestions = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            updateStats();
            generateQuestion();
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šéšæœºæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
